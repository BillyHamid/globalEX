import{r as c,j as e}from"./react-PleRxLNr.js";import{u as V,g as X,s as R,t as W}from"./index-ByeexPDm.js";import{K as B}from"./KPICard-Cu82P0ks.js";import{u as I}from"./router-CwZiKTye.js";import{a as O,G as U,A as Y,i as _,C as q}from"./lucide-DAQsc5bm.js";import{R as T,L as H,C as M,X as J,Y as Q,T as D,a as E,P as Z,b as ee,c as se,d as te}from"./recharts-CQwtmcro.js";const ae=a=>{const n={pending:"bg-amber-100 text-amber-800",paid:"bg-emerald-100 text-emerald-800",in_progress:"bg-blue-100 text-blue-800",cancelled:"bg-red-100 text-red-800"},s={pending:"En attente",paid:"Payé",in_progress:"En cours",cancelled:"Annulé"};return e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${n[a]||"bg-gray-100 text-gray-800"}`,children:s[a]||a})},m=(a,n="USD")=>n==="XOF"?`${Math.round(a).toLocaleString("fr-FR")} XOF`:`$${a.toLocaleString("fr-FR",{minimumFractionDigits:0,maximumFractionDigits:0})}`,xe=()=>{var b,y,N,v,w,S,k,A,C;const{user:a}=V(),n=I(),[s,P]=c.useState(null),[o,F]=c.useState(null),[g,$]=c.useState([]),[K,u]=c.useState(!0),[h,p]=c.useState(null);if(c.useEffect(()=>{(async()=>{if(a){u(!0),p(null);try{const[r,d,i]=await Promise.all([R.getDashboard(),R.getTransfers(),W.getAll({limit:5})]);P(r),F(d),$((i==null?void 0:i.data)||[])}catch(r){p(r.message||"Erreur lors du chargement des indicateurs")}finally{u(!1)}}})()},[a]),!a)return null;if(K)return e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[50vh] gap-4",children:[e.jsx(O,{className:"w-10 h-10 text-emerald-600 animate-spin"}),e.jsx("p",{className:"text-gray-600",children:"Chargement des indicateurs..."})]});if(h)return e.jsxs("div",{className:"bg-red-50 border border-red-100 rounded-xl p-6 text-center",children:[e.jsx("p",{className:"text-red-700",children:h}),e.jsx("p",{className:"text-sm text-gray-600 mt-2",children:"Vérifiez que le backend est démarré."})]});const l=(s==null?void 0:s.byStatus)||{pending:{count:0},inProgress:{count:0},paid:{count:0},cancelled:{count:0}},f=l.pending.count+l.inProgress.count+l.paid.count+l.cancelled.count,z=f>0?(l.paid.count/f*100).toFixed(1):"0",G=[{label:"Total transferts",value:((b=s==null?void 0:s.month)==null?void 0:b.transfers)??0,icon:"ArrowLeftRight"},{label:"Volume ce mois",value:m(((y=s==null?void 0:s.month)==null?void 0:y.totalSent)??0),icon:"DollarSign"},{label:"En attente",value:l.pending.count,icon:"Clock"},{label:"Payés",value:l.paid.count,icon:"CheckCircle"},{label:"Taux de réussite",value:`${z}%`,icon:"TrendingUp"},{label:"Frais ce mois",value:m(((N=s==null?void 0:s.month)==null?void 0:N.totalFees)??0),icon:"DollarSign"}],x=[{name:"Payés",value:l.paid.count,color:"#10b981"},{name:"En attente",value:l.pending.count,color:"#f59e0b"},{name:"En cours",value:l.inProgress.count,color:"#3b82f6"},{name:"Annulés",value:l.cancelled.count,color:"#ef4444"}].filter(t=>t.value>0),j=((v=o==null?void 0:o.monthly)==null?void 0:v.map(t=>({month:t.month,envoyés:t.sent,payés:t.paid})))||[];return e.jsxs("div",{className:"space-y-4 sm:space-y-6 lg:space-y-8",children:[e.jsx("div",{className:"bg-gradient-to-r from-emerald-600 to-teal-700 text-white rounded-xl sm:rounded-2xl lg:rounded-3xl p-4 sm:p-6 lg:p-8 shadow-xl",children:e.jsxs("div",{className:"flex flex-col gap-4 sm:gap-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 mb-1 sm:mb-2",children:[e.jsx(U,{className:"w-6 h-6 sm:w-8 sm:h-8"}),e.jsx("h1",{className:"text-xl sm:text-2xl lg:text-3xl font-bold",children:"GLOBAL EXCHANGE"})]}),e.jsxs("p",{className:"text-emerald-100 text-sm sm:text-base lg:text-lg",children:["Bienvenue, ",a.name," — ",X(a.role)]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 sm:gap-4",children:[e.jsxs("div",{className:"bg-white/20 backdrop-blur-sm rounded-lg sm:rounded-xl p-3 sm:p-4 border border-white/30",children:[e.jsx("p",{className:"text-xs sm:text-sm opacity-90",children:"Transferts aujourd'hui"}),e.jsx("p",{className:"text-lg sm:text-xl lg:text-2xl font-bold",children:((w=s==null?void 0:s.today)==null?void 0:w.transfers)??0})]}),e.jsxs("div",{className:"bg-white/20 backdrop-blur-sm rounded-lg sm:rounded-xl p-3 sm:p-4 border border-white/30",children:[e.jsx("p",{className:"text-xs sm:text-sm opacity-90",children:"Volume aujourd'hui"}),e.jsx("p",{className:"text-lg sm:text-xl lg:text-2xl font-bold",children:((S=s==null?void 0:s.today)==null?void 0:S.totalSent)!=null?m(s.today.totalSent):"—"})]})]})]})}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-2 lg:grid-cols-3 gap-3 sm:gap-4 lg:gap-6",children:G.map((t,r)=>e.jsx(B,{kpi:t},r))}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6 lg:gap-8",children:[e.jsxs("div",{className:"bg-white rounded-xl sm:rounded-2xl shadow-lg border border-gray-100 p-4 sm:p-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 sm:gap-0 mb-4 sm:mb-6",children:[e.jsxs("h2",{className:"text-base sm:text-lg lg:text-xl font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(Y,{className:"h-5 w-5 sm:h-6 sm:w-6 text-emerald-600 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:"Transferts (6 mois)"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs sm:text-sm",children:[e.jsx("div",{className:"w-2 h-2 sm:w-3 sm:h-3 rounded-full bg-emerald-500"}),e.jsx("span",{className:"text-gray-600",children:"Envoyés"}),e.jsx("div",{className:"w-2 h-2 sm:w-3 sm:h-3 rounded-full bg-blue-500 ml-2 sm:ml-3"}),e.jsx("span",{className:"text-gray-600",children:"Payés"})]})]}),j.length>0?e.jsx(T,{width:"100%",height:250,children:e.jsxs(H,{data:j,children:[e.jsx(M,{strokeDasharray:"3 3",vertical:!1}),e.jsx(J,{dataKey:"month",axisLine:!1,tickLine:!1,tick:{fontSize:12}}),e.jsx(Q,{axisLine:!1,tickLine:!1,tick:{fontSize:12},width:35}),e.jsx(D,{contentStyle:{backgroundColor:"white",borderRadius:"8px",border:"1px solid #e5e7eb",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1)",fontSize:"12px"}}),e.jsx(E,{type:"monotone",dataKey:"envoyés",stroke:"#10b981",strokeWidth:2,dot:{stroke:"#10b981",strokeWidth:2,r:3,fill:"white"},name:"Envoyés"}),e.jsx(E,{type:"monotone",dataKey:"payés",stroke:"#3b82f6",strokeWidth:2,dot:{stroke:"#3b82f6",strokeWidth:2,r:3,fill:"white"},name:"Payés"})]})}):e.jsx("div",{className:"h-[250px] flex items-center justify-center text-gray-400 text-sm",children:"Aucune donnée sur la période"})]}),e.jsxs("div",{className:"bg-white rounded-xl sm:rounded-2xl shadow-lg border border-gray-100 p-4 sm:p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4 sm:mb-6",children:[e.jsxs("h2",{className:"text-base sm:text-lg lg:text-xl font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(_,{className:"h-5 w-5 sm:h-6 sm:w-6 text-emerald-600 flex-shrink-0"}),e.jsx("span",{children:"Statut"})]}),e.jsxs("div",{className:"bg-emerald-100 text-emerald-800 px-2 sm:px-3 py-1 rounded-full text-xs sm:text-sm font-medium",children:["Total: ",x.reduce((t,r)=>t+r.value,0)]})]}),x.length>0?e.jsx("div",{className:"flex items-center justify-center",children:e.jsx(T,{width:"100%",height:250,children:e.jsxs(Z,{children:[e.jsx(ee,{data:x,cx:"50%",cy:"50%",innerRadius:45,outerRadius:80,paddingAngle:5,dataKey:"value",children:x.map((t,r)=>e.jsx(se,{fill:t.color},`cell-${r}`))}),e.jsx(D,{}),e.jsx(te,{wrapperStyle:{fontSize:"12px"}})]})})}):e.jsx("div",{className:"h-[250px] flex items-center justify-center text-gray-400 text-sm",children:"Aucun transfert"})]})]}),e.jsxs("div",{className:"bg-white rounded-xl sm:rounded-2xl shadow-lg border border-gray-100 p-4 sm:p-6",children:[e.jsxs("h2",{className:"text-base sm:text-lg lg:text-xl font-bold text-gray-800 mb-4 sm:mb-6 flex items-center gap-2",children:[e.jsx(q,{className:"h-5 w-5 sm:h-6 sm:w-6 text-amber-600 flex-shrink-0"}),"Transferts récents"]}),e.jsx("div",{className:"space-y-3 sm:space-y-4",children:g.length===0?e.jsx("p",{className:"text-gray-500 text-sm py-4",children:"Aucun transfert récent"}):g.map(t=>{var r,d,i,L;return e.jsxs("div",{className:"flex items-start sm:items-center justify-between p-3 sm:p-4 bg-gray-50 rounded-lg sm:rounded-xl hover:bg-gray-100 active:bg-gray-200 transition-colors touch-manipulation cursor-pointer",onClick:()=>n(`/transfers/${t.id}`),children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-1 sm:gap-2",children:[e.jsx("span",{className:"font-mono text-xs sm:text-sm text-emerald-600 font-semibold",children:t.reference}),ae(t.status)]}),e.jsxs("p",{className:"text-xs sm:text-sm text-gray-600 mt-1 truncate",children:[(r=t.sender)==null?void 0:r.firstName," ",(d=t.sender)==null?void 0:d.lastName," → ",(i=t.beneficiary)==null?void 0:i.firstName," ",(L=t.beneficiary)==null?void 0:L.lastName]}),e.jsx("p",{className:"text-[10px] sm:text-xs text-gray-400",children:t.createdAt?new Date(t.createdAt).toLocaleString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}):"—"})]}),e.jsx("div",{className:"text-right ml-2 flex-shrink-0",children:e.jsx("p",{className:"text-sm sm:text-base lg:text-lg font-bold text-gray-900",children:t.amountSent!=null?`${t.amountSent.toLocaleString("fr-FR")} ${t.currencySent||"USD"}`:"—"})})]},t.id)})}),e.jsx("button",{type:"button",onClick:()=>n("/transfers"),className:"w-full mt-3 sm:mt-4 py-2.5 sm:py-2 text-emerald-600 font-medium hover:bg-emerald-50 active:bg-emerald-100 rounded-lg transition-colors touch-manipulation text-sm sm:text-base",children:"Voir tous les transferts →"})]}),e.jsx("div",{className:"bg-gradient-to-r from-emerald-50 to-teal-50 rounded-xl sm:rounded-2xl p-4 sm:p-6 border border-emerald-100",children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"text-center sm:text-left",children:[e.jsx("h3",{className:"text-base sm:text-lg font-semibold text-gray-900",children:"Ce mois"}),e.jsx("p",{className:"text-gray-600 text-sm mt-1",children:"Transferts et volume"})]}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-3 sm:gap-4 lg:gap-6",children:[e.jsxs("div",{className:"text-center bg-white/50 rounded-lg sm:rounded-xl p-3",children:[e.jsx("p",{className:"text-lg sm:text-xl lg:text-2xl font-bold text-emerald-600",children:((k=s==null?void 0:s.month)==null?void 0:k.transfers)??0}),e.jsx("p",{className:"text-xs sm:text-sm text-gray-600",children:"Transferts"})]}),e.jsxs("div",{className:"text-center bg-white/50 rounded-lg sm:rounded-xl p-3",children:[e.jsx("p",{className:"text-lg sm:text-xl lg:text-2xl font-bold text-blue-600",children:m(((A=s==null?void 0:s.month)==null?void 0:A.totalSent)??0)}),e.jsx("p",{className:"text-xs sm:text-sm text-gray-600",children:"Volume"})]}),e.jsxs("div",{className:"text-center bg-white/50 rounded-lg sm:rounded-xl p-3",children:[e.jsx("p",{className:"text-lg sm:text-xl lg:text-2xl font-bold text-amber-600",children:l.pending.count}),e.jsx("p",{className:"text-xs sm:text-sm text-gray-600",children:"En attente"})]}),e.jsxs("div",{className:"text-center bg-white/50 rounded-lg sm:rounded-xl p-3",children:[e.jsx("p",{className:"text-lg sm:text-xl lg:text-2xl font-bold text-purple-600",children:m(((C=s==null?void 0:s.month)==null?void 0:C.totalFees)??0)}),e.jsx("p",{className:"text-xs sm:text-sm text-gray-600",children:"Frais"})]})]})]})})]})};export{xe as Dashboard};
