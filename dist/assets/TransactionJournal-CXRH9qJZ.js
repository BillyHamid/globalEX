import{r,j as e}from"./react-PleRxLNr.js";import{u as R,s as E}from"./index-ByeexPDm.js";import{F as j,R as N,o as U,q as L,G as D,a as k,v as y,i as B,C as v}from"./lucide-DAQsc5bm.js";import"./router-CwZiKTye.js";const d={pending:{label:"En attente",color:"bg-amber-100 text-amber-800",icon:v},in_progress:{label:"En cours",color:"bg-purple-100 text-purple-800",icon:N},paid:{label:"Payé",color:"bg-emerald-100 text-emerald-800",icon:B},cancelled:{label:"Annulé",color:"bg-red-100 text-red-800",icon:y}},P=()=>{const{user:S}=R(),[x,w]=r.useState([]),[a,C]=r.useState(null),[T,i]=r.useState(!0),[m,u]=r.useState(null),[l,p]=r.useState(""),[c,A]=r.useState("all"),[h,g]=r.useState(!1),o=async(s=!1)=>{s?g(!0):i(!0),u(null);try{const t={};l&&(t.date=l),c!=="all"&&(t.country=c);const n=await E.getJournal(t);w(n.journal),C(n.summary)}catch(t){console.error("Error fetching journal:",t),u(t.message||"Erreur lors du chargement du journal")}finally{i(!1),g(!1)}};r.useEffect(()=>{o()},[l,c]);const F=s=>new Date(s).toLocaleString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}),b=(s,t)=>`${s.toLocaleString()} ${t}`;return S?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-900 flex items-center gap-2",children:[e.jsx(j,{className:"w-7 h-7 text-emerald-600"}),"Journal des Transactions"]}),e.jsx("p",{className:"text-gray-600",children:"Récapitulatif avec totaux cumulatifs (Tmount, Tfees = USA → BF payés uniquement)"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>o(!0),disabled:h,className:"p-3 border border-gray-300 rounded-xl hover:bg-gray-50 transition-colors",title:"Rafraîchir",children:e.jsx(N,{className:`w-5 h-5 ${h?"animate-spin":""}`})}),e.jsxs("button",{className:"px-4 py-3 border border-gray-300 rounded-xl hover:bg-gray-50 flex items-center gap-2 transition-colors",children:[e.jsx(U,{className:"w-5 h-5"}),"Exporter"]})]})]}),e.jsx("div",{className:"bg-white rounded-xl p-4 border border-gray-100 shadow-sm",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(L,{className:"w-5 h-5 text-gray-400"}),e.jsx("input",{type:"date",value:l,onChange:s=>p(s.target.value),className:"px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-emerald-500",placeholder:"Toutes les dates"}),l&&e.jsx("button",{onClick:()=>p(""),className:"px-3 py-2 text-sm text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors",title:"Afficher toutes les dates",children:"Effacer"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(D,{className:"w-5 h-5 text-gray-400"}),e.jsxs("select",{value:c,onChange:s=>A(s.target.value),className:"px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-emerald-500",children:[e.jsx("option",{value:"all",children:"Tous les pays"}),e.jsx("option",{value:"USA",children:"USA"}),e.jsx("option",{value:"BFA",children:"Burkina Faso"})]})]})]})}),a&&e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4",children:[e.jsxs("div",{className:"bg-white rounded-xl p-4 border border-gray-100 shadow-sm",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Total Transferts"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:a.totalTransfers})]}),e.jsxs("div",{className:"bg-blue-50 rounded-xl p-4 border border-blue-100",children:[e.jsx("p",{className:"text-sm text-blue-600",children:"Tmount (USA → BF)"}),e.jsxs("p",{className:"text-2xl font-bold text-blue-700",children:[(a.tmountUsd??a.totalAmount).toLocaleString("fr-FR")," USD"]})]}),e.jsxs("div",{className:"bg-amber-50 rounded-xl p-4 border border-amber-100",children:[e.jsx("p",{className:"text-sm text-amber-600",children:"Tfees (USA → BF)"}),e.jsxs("p",{className:"text-2xl font-bold text-amber-700",children:[(a.tfeesUsd??a.totalFees).toLocaleString("fr-FR")," USD"]})]}),e.jsxs("div",{className:"bg-emerald-50 rounded-xl p-4 border border-emerald-100",children:[e.jsx("p",{className:"text-sm text-emerald-600",children:"Total Reçu"}),e.jsxs("p",{className:"text-2xl font-bold text-emerald-700",children:[a.totalReceived.toLocaleString()," XOF"]})]}),e.jsxs("div",{className:"bg-purple-50 rounded-xl p-4 border border-purple-100",children:[e.jsx("p",{className:"text-sm text-purple-600",children:"En attente"}),e.jsx("p",{className:"text-2xl font-bold text-purple-700",children:a.pendingCount})]}),e.jsxs("div",{className:"bg-green-50 rounded-xl p-4 border border-green-100",children:[e.jsx("p",{className:"text-sm text-green-600",children:"Payés"}),e.jsx("p",{className:"text-2xl font-bold text-green-700",children:a.paidCount})]})]}),T?e.jsxs("div",{className:"bg-white rounded-xl border border-gray-100 shadow-sm p-12 flex flex-col items-center justify-center",children:[e.jsx(k,{className:"w-8 h-8 text-emerald-600 animate-spin mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Chargement du journal..."})]}):m?e.jsxs("div",{className:"bg-red-50 rounded-xl border border-red-100 p-6 text-center",children:[e.jsx(y,{className:"w-8 h-8 text-red-500 mx-auto mb-2"}),e.jsx("p",{className:"text-red-700",children:m}),e.jsx("button",{onClick:()=>o(),className:"mt-4 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700",children:"Réessayer"})]}):x.length===0?e.jsxs("div",{className:"bg-white rounded-xl border border-gray-100 shadow-sm p-12 text-center",children:[e.jsx(j,{className:"w-12 h-12 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 text-lg",children:l?"Aucune transaction pour cette date":"Aucune transaction enregistrée"})]}):e.jsx("div",{className:"bg-white rounded-xl border border-gray-100 shadow-sm overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase",children:"Réf."}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase",children:"Bénéficiaire"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-semibold text-gray-600 uppercase",children:"Montant"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-semibold text-gray-600 uppercase",children:"Frais"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-semibold text-gray-600 uppercase",children:"Tmount"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-semibold text-gray-600 uppercase",children:"Tfees"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase",children:"Agent"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase",children:"Statut"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase",children:"Date"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:x.map(s=>{var f;const t=((f=d[s.status])==null?void 0:f.icon)||v,n=d[s.status]||d.pending;return e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:"font-mono text-sm text-emerald-600 font-semibold",children:s.reference})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:s.beneficiary.name}),e.jsx("p",{className:"text-xs text-gray-500",children:s.beneficiary.phone})]})}),e.jsx("td",{className:"px-4 py-3 text-right",children:e.jsx("span",{className:"text-sm font-medium",children:b(s.amountSent,s.currencySent)})}),e.jsx("td",{className:"px-4 py-3 text-right",children:e.jsx("span",{className:"text-sm text-amber-600 font-medium",children:b(s.fees,s.currencySent)})}),e.jsx("td",{className:"px-4 py-3 text-right",children:e.jsx("span",{className:"text-sm font-bold text-blue-600",children:s.cumulative.amount.toLocaleString()})}),e.jsx("td",{className:"px-4 py-3 text-right",children:e.jsx("span",{className:"text-sm font-bold text-amber-600",children:s.cumulative.fees.toLocaleString()})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-900",children:s.creator.name}),e.jsx("p",{className:"text-xs text-gray-500",children:s.creator.country})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium ${n.color}`,children:[e.jsx(t,{className:"w-3 h-3"}),n.label]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:"text-sm text-gray-600",children:F(s.createdAt)})})]},s.id)})})]})})})]}):null};export{P as TransactionJournal};
